name: kube-apiserver
architectures: ['$SNAP_ARCH']
version: '$KUBE_VERSION'
summary: kube-apiserver
description: kube-apiserver
grade: stable
confinement: strict

apps:
  daemon:
    command: run-with-config-args kube-apiserver-wrapper
    daemon: simple
    plugs:
        - home
        - network
        - network-bind
  kube-apiserver:
    command: kube-apiserver
    plugs:
        - home
        - network
        - network-bind
parts:
  kube-apiserver:
    plugin: dump
    source: .
    override-build: |
      set -eu
      cp $KUBE_SNAP_BINS/$KUBE_ARCH/kube-apiserver .
      cp $KUBE_SNAP_ROOT/shared/run-with-config-args .
      cp $KUBE_SNAP_ROOT/kube-apiserver/kube-apiserver-wrapper .
      $KUBE_SNAP_ROOT/shared/generate-configure-hook kube-apiserver

      # --v is missing from help output in 1.12
      alias add-arg=$KUBE_SNAP_ROOT/shared/add-arg-to-configure-hook
      add-arg string v

      snapcraftctl build
