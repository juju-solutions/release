KUBE_VERSION=$(shell curl -L https://dl.k8s.io/release/stable.txt)
KUBE_ARCH=amd64

ifndef VERBOSE
	MAKEFLAGS += --no-print-directory
endif

targets = kubectl kube-apiserver kube-controller-manager kube-scheduler kubelet kube-proxy kubeadm kubefed

build = ./build-scripts/build

.PHONY: $(targets)

all-arch:
	for arch in amd64 arm arm64 ppc64le s390x ; do \
		make KUBE_ARCH=$$arch default; \
	done

default:
	@KUBE_VERSION=${KUBE_VERSION} KUBE_ARCH=${KUBE_ARCH} ${build} $(targets)

clean:
	@rm -rf build

kubectl:
	@KUBE_VERSION=${KUBE_VERSION} KUBE_ARCH=${KUBE_ARCH} ${build} kubectl

kubeadm:
	@KUBE_VERSION=${KUBE_VERSION} KUBE_ARCH=${KUBE_ARCH} ${build} kubeadm

kubefed:
	@KUBE_VERSION=${KUBE_VERSION} KUBE_ARCH=${KUBE_ARCH} ${build} kubefed

kube-apiserver:
	@KUBE_VERSION=${KUBE_VERSION} KUBE_ARCH=${KUBE_ARCH} ${build} kube-apiserver

kube-controller-manager:
	@KUBE_VERSION=${KUBE_VERSION} KUBE_ARCH=${KUBE_ARCH} ${build} kube-controller-manager

kube-scheduler:
	@KUBE_VERSION=${KUBE_VERSION} KUBE_ARCH=${KUBE_ARCH} ${build} kube-scheduler

kubelet:
	@KUBE_VERSION=${KUBE_VERSION} KUBE_ARCH=${KUBE_ARCH} ${build} kubelet

kube-proxy:
	@KUBE_VERSION=${KUBE_VERSION} KUBE_ARCH=${KUBE_ARCH} ${build} kube-proxy
